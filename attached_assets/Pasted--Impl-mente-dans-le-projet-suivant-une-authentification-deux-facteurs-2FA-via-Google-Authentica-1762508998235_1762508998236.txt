Â« ImplÃ©mente dans le projet suivant une authentification Ã  deux facteurs (2FA) via Google Authenticator (TOTP), compatible avec Express.js, PostgreSQL, et un frontend sur Vercel.

Le backend est hÃ©bergÃ© sur Render Ã  https://api.altusfinancegroup.com, la base est PostgreSQL, et le frontend est sur Vercel (https://altusfinancegroup.com).

Le systÃ¨me actuel utilise dÃ©jÃ  une authentification avec e-mail et OTP, donc ajoute une option alternative 2FA via Google Authenticator pour les utilisateurs qui veulent renforcer leur sÃ©curitÃ©.

âš™ï¸ SpÃ©cifications techniques :

Utilise les librairies speakeasy (pour gÃ©nÃ©rer les secrets TOTP) et qrcode (pour afficher le QR code cÃ´tÃ© frontend).

Ajoute dans la base de donnÃ©es une colonne two_factor_secret (texte, nullable) et two_factor_enabled (boolÃ©en, false par dÃ©faut) dans la table users.

CrÃ©e trois routes dans le backend :

POST /api/2fa/setup â†’ gÃ©nÃ¨re un secret et renvoie lâ€™URL de QR code Ã  afficher dans lâ€™application Google Authenticator.

POST /api/2fa/verify â†’ vÃ©rifie le code saisi par lâ€™utilisateur et active two_factor_enabled sâ€™il est correct.

POST /api/2fa/validate â†’ vÃ©rifie le code TOTP Ã  chaque connexion si 2FA est activÃ© pour cet utilisateur.

Assure-toi que les CORS et CSRF sont compatibles avec le frontend Vercel (https://altusfinancegroup.com).

Si lâ€™utilisateur a activÃ© le 2FA, la connexion ne doit Ãªtre validÃ©e quâ€™aprÃ¨s vÃ©rification du TOTP.

Si non activÃ©, la connexion classique par OTP email continue de fonctionner.

Toutes les erreurs doivent Ãªtre gÃ©rÃ©es avec un message clair ("Code invalide", "Session expirÃ©e", "2FA requis", etc.).

ğŸ’» Frontend :

Ajoute une page /security/2fa accessible depuis le profil.

Cette page doit afficher :

Le QR code Ã  scanner.

Un champ pour saisir le code Ã  6 chiffres.

Un bouton â€œActiver la vÃ©rification en deux Ã©tapesâ€.

Lors de la connexion, si le 2FA est activÃ©, redirige lâ€™utilisateur vers /verify-2fa pour saisir son code.

âœ… RÃ©sultat attendu :

Lâ€™utilisateur peut activer la 2FA dans son profil.

Ã€ chaque nouvelle connexion, il doit saisir son code Google Authenticator.

Le systÃ¨me continue de supporter lâ€™OTP email comme mÃ©thode alternative.

Tout est compatible avec Render (backend) et Vercel (frontend).